<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
    <link href="styles/style.css" rel="stylesheet" type="text/css">
    <link href="styles/framework.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.carousel.css" rel="stylesheet" type="text/css">
    <link href="styles/owl.theme.css" rel="stylesheet" type="text/css">
    <link href="styles/swipebox.css" rel="stylesheet" type="text/css">
    <link href="styles/font-awesome.css" rel="stylesheet" type="text/css">
    <link href="styles/animate.css" rel="stylesheet" type="text/css">

    <!--SCRIPTS BASICOS-->
    <script src="scripts/jquery-2.1.4.js"></script>
    <script type="text/javascript" src="scripts/jqueryui.js"></script>
    <script type="text/javascript" src="scripts/framework.plugins.js"></script>
    <script type="text/javascript" src="scripts/custom.js"></script>
    <script type="text/javascript" src="scripts/jsmodel/wscotacao.js"></script>
    <script>

        var DATA = '';

        function PreencheSelect(ID_ESTABELECIMENTO) {
            jQuery('#MOEDA').append('<option value="" selected>Selecione uma moeda</option>');
            var data = jQuery.parseJSON(RetornaListaMoedaEstabelecimentoCotacao(ID_ESTABELECIMENTO, null, null));
            if (data.length > 0) {
                jQuery.each(data, function () {
                    MontaSelect('MOEDA', this.SIMBOLO, this.NOME_MOEDA, this.PAIS);
                });

            }
        }

        function MontaSelect(OBJETO, SIMBOLO, NOME_MOEDA, PAIS) {
            jQuery('#' + OBJETO + '').append('<option value=' + SIMBOLO + '>' + NOME_MOEDA + '</option>');
        }

        function BuscaUltimoValorVO() {

            var ID_ESTABELECIMENTO = DATA.ID_ESTABELECIMENTO;
            var MOEDA = jQuery('#MOEDA').val();
            var data = jQuery.parseJSON(RetornaCotacaoEstabelecimentoPorMoeda(ID_ESTABELECIMENTO, MOEDA, null, null));
            CarregaUltimaCotacao(data);
        }

        function CarregaCotacaoEstabelecimento(ID_ESTABELECIMENTO, MOEDA) {

        }


        function RetornaEstabelecimento(ID_ESTABELECIMENTO) {
            var data = jQuery.parseJSON(RetornaEstabelecimentoPorId(ID_ESTABELECIMENTO, null, null));
            if (data.length > 0) {
                jQuery.each(data, function () {
                    MontaMapa(this);
                });
            }
        }

        function CarregaUltimaCotacao(data) {
            jQuery('#VALOR_COMPRA').text('R$ ' + data[0].TAXA_COMPRA);
            jQuery('#VALOR_VENDA').text('R$ ' + data[0].TAXA_VENDA);
        }

        function getUrlVars() {
            var vars = [], hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }

        jQuery(document).ready(function () {
            DATA = getUrlVars();
            if (!DATA.hasOwnProperty('ID_MOEDA')) {
                jQuery('#DIVCOTACAO').css('display', 'none');
                PreencheSelect(DATA.ID_ESTABELECIMENTO);
                RetornaEstabelecimento(DATA.ID_ESTABELECIMENTO);
            }
            else {
                CarregaCotacaoEstabelecimento(DATA.ID_ESTABELECIMENTO, DATA.ID_MOEDA);
                jQuery('#DIVBUSCACOTACAO').css('display', 'none');
            }
        });

        function MontaMapa(data) {

            var html = "<strong class='contact-text'>" + data.NOME + "</strong><br>" +
               "<a class='contact-call' href='#'>Tel :" + data.FONE + "</a>" +
               //"<a class='contact-mail' href='#'>Email: " + data.EMAIL + "</a>" +
               "<a class='contact-text' href='#'>Endereço :" + data.ENDERECO + "," + data.NUMERO + "</a>" +
               "<a class='contact-text' href='#'>" + data.COMPLEMENTO + " " + data.BAIRRO + "</a>" +
               "<a class='contact-text' href='#'>" + data.CIDADE + "," + data.UF + "</a>";

            jQuery('#DIVINFO').html(html);
        }
    </script>
</head>
<body style="background-color:white;">
    <div id="DIVINFO">

    </div>
    <div id="DIVBUSCACOTACAO">
        <div class="contact-text">Moeda:</div>
        <select name="" class="contact-text" id="MOEDA" onchange="BuscaUltimoValorVO();"></select>
        <span>
            <label class="contact-text">Compra :</label>
            <label class="contact-text" id="VALOR_COMPRA"></label>
        </span>
        <span>
            <label class="contact-text">Venda :</label>
            <label class="contact-text" id="VALOR_VENDA"></label>
        </span>
    </div>
    <div id="DIVCOTACAO">
        <span>
            <label class="contact-text">Compra :</label>
            <label class="contact-text" id="LBLVALOR_COMPRA"></label>
        </span>
        <span>
            <label class="contact-text">Venda :</label>
            <label class="contact-text" id="LBLVALOR_VENDA"></label>
        </span>
    </div>
</body>
</html>
